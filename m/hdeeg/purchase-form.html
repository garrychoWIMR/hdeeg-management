<section>
<div id=D__ID>
	<!--third html start -->
	<div class="container mt-95 mb-3">
		<div class="row">
			<!-- form container start -->
			<div class="col-12 col-lg-12 col-md-12 col-sm-12 mx-auto formbox">
				<div class="row">
					<div class="col-12">
						<!-- form start -->
						<form id="F__ID">
						<h3><span>Purchase order request form</span></h3>
						<!--section start-->
						<div class="form-group ">
							<div class="questiongroup ">
								<fieldset class="subquestions">
									<div class="row">
										<div class="col-lg-3 col-sm-12">
											<div class="input-group-sm ">
										<div><label><span class=""><h4><u>Vendor Details</u></h4></span></label></div>
										</div>		
										</div>
										</div>
											<div class="row">
												<div class="col-lg-3 col-sm-12">
													<div class="input-group-sm ">
												<div><label><span class="">Account No.</span></label></div>
													<input type="text" name=v_acc_no id=v_acc_no__ID>
											</div>
										</div>
										<div class="col-lg-3 col-sm-12">
											<div class="input-group-sm ">
												<div><label><span class="">Name</span></label></div>
												<input type="text" name=v_name id=v_name__ID>
											</div>
										</div>
										<div class="col-lg-3 col-sm-12">
											<div class="input-group-sm ">
												<div><label><span class="">Address:</span></label></div>
													<input type=text name=v_add id=v_add__ID />
											</div>
										</div>
									<div class="col-lg-3 col-sm-12">
										<div class="input-group-sm ">
												<div><label><span class="">Phone Number:</span></label></div>
													<input type=text name=v_ph_number id=v_ph_number__ID />
										</div>
									</div>
										<div class="col-lg-3 col-sm-12">
										<div class="input-group-sm ">
												<div><label><span class="">Email:</span></label></div>
													<input type=text name=v_email id=v_email__ID />
										</div>
									</div>
									
										</div>
									</div>
								</div>
							</div>
						</fieldset>
					</div>
				<div>
			<!--section end-->
			<!--section start-->
			<div class="form-group ">
				<div class="questiongroup ">
					<fieldset class="subquestions">
						<div class="row">
							<div class="col-lg-3 col-sm-12">
								<div class="input-group-sm ">
												<div><label><span class="">Date:</span></label></div>
												<input type=text name=date id=date__ID readonly/>
											</div>
										</div>
										<div class="col-lg-3 col-sm-12">
											<div class="input-group-sm ">
									<div><label><span class="" >Purchase Order No.</span></label></div>
									<input type="text" name=po_number id=po_number__ID Placeholder="YYMMDDHHM">
								</div>
							</div>
							<div class="col-lg-3 col-sm-12">
								<div class="input-group-sm ">
									<div><label><span class="">Quotation Number</span></label></div>
									<input type="text" name=quote_no id=quote_no__ID>
								</div>
							</div>
							<div class="col-lg-3 col-sm-12">
								<div class="input-group-sm ">
									<div><label><span class="">Delivering to:</span></label></div>
									<input type=date name=deliver_to id=deliver_to__ID />
								</div>
							</div>
								<div class="col-lg-3 col-sm-12">
									<div class="input-group-sm ">
										<div><label><span class="">Status</span></label></div>
										<select name="status" id=status__ID>
											<option>Approved</option>
											<option>Submitted</option>
											<option>Received</option>
											<option>ioshfioshdfio</option>
											</select>
										</div>
									</div>
									<div class="col-lg-3 col-sm-12">
								<div class="input-group-sm ">
									<div><label><span class="">Delivery Costs</span></label></div>
									<input type=text name=delivery id=delivery__ID >
								</div>
							</div>
						</div>
					</fieldset>
				</div>
			</div>
			<!-- <section end>
			<section start-->
	
			<!-- <section end-->
			<!--Section start-->
<hr style="border-top: 1px solid #888;width: 100%;margin:10px 0">
<div>
	<div w='100|100'>
		<u class=c_print style='cursor:pointer;margin-bottom:3px;display:inline-block' id=item_a_add__ID><i
				class="fa fa-plus"></i> Add an item</u>
		<table id=grid_item_a__ID></table>
		<div id=total__ID style='text-align: right;padding-top:6px'>
			GST Amount: <input type=text name=GST_Amount style="width:120px;margin-bottom:1px" readonly><br>
			Total Amount: <input type=text name=Total_Amount style="width:120px" readonly>
		</div>
	</div>
</div>
<div>
			<!-- <section end-->


						<section style='display:none'>
							<input type="text" name=Status />
						</section>
									<button type="submit" id="submit__ID" class="btn btn-primary btn-lg">Submit</button>
									<button id=delete__ID type="button" class="btn btn-primary btn-lg">Delete</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
		VmInclude:__COMPONENT__/m/model.01.html
    <script>
		function textAreaAdjust__ID(o) {
			//console.log(o)
			o.style.height = "1px";
			o.style.height = (25+o.scrollHeight)+"px";
		}
			//-------------------------------------
    	function F__ID(){
    		//-------------------------------------
			VmInclude:__COMPONENT__/f/form.01.js
			//VmInclude:__COMPONENT__/f/form-item-a.01.js
			//VmInclude:__CURRENT_PATH__purchase-form.html.item_a_list.js
			//-------------------------------------
			
			// new ResizeObserver($vm.responsive).observe(form_container__ID);
			m.storage_type = 's0';
			item_a_list();
			//-------------------------------------
			
			var item_a_list = function () {
				//----------------------------------
				//item a part
				m.item_a_fields = "Item_No,Description,Unit_Price,Quantity,GST,Amount,_Remove";
				//----------------------------------
				$('#item_a_add__ID').on('click', function () { m.item_a_add(); })
				//----------------------------------
				m.item_a_cell_render = function (records, I, field, td, set_value, source) {
					switch (field) {
						case "Amount":
							td.find('div:first').removeAttr('contenteditable');
							break;
						case "GST":
							var html = '<input type=checkbox />';
							$vm.render_checkbox_field(records[I], '__ID', td, html)
							td.find('input').on('change', function () {
								cal();
							})
							break;
					}
				}
				//----------------------------------
				m.item_a_after_change = function (records, I, field, td, set_value, source) {
					switch (field) {
						case "Unit_Price":
						case "Quantity":
							/*case "GST":*/
							cal();
							break;
					}
				}
				//----------------------------------
				m.item_a_after_remove = function () {
					cal();
				}
				$('#F__ID input[name=Delivery]').on('change', function () {
					cal();
				})
				//----------------------------------
				var cal = function () {
					var total = 0, subtotal = 0, gst = 0;
					for (var i = 0; i < m.item_a_records.length; i++) {
						var p = parseFloat(m.item_a_records[i].Unit_Price);
						var q = parseFloat(m.item_a_records[i].Quantity);
						if (m.item_a_records[i].Unit_Price == '') p = 0;
						if (m.item_a_records[i].Quantity == '') q = 0;
						var a = p * q;
						if (m.item_a_records[i].GST == '1') {
							gst += a * 0.1;
							a = a * 1.1;
						}
						m.item_a_records[i].Amount = a.toFixed(2);
						total += a;
					}
					$('#F__ID input[name=GST_Amount]').val(gst.toFixed(2));
					$('#F__ID input[name=Total_Amount]').val(total.toFixed(2));
					m.item_a_render();
				}
				//----------------------------------
			}
			//-----------------------------------
			var item_a_render = function () {
				//-------item a part
				m.item_a_records = []; if (m.input.record != undefined && m.input.record.Data.items != undefined) m.item_a_records = m.input.record.Data.items;
				m.item_a_render();
				//-------
			}
//-----------------------------------
			
			
			
			
			var old_m_load = m.load;
			m.load = function () {
				old_m_load();
				if (m.input.record != undefined && m.input.record.Data.Status == "Submit") {
					$('#draft__ID').hide();
					$('#submit__ID').hide();
				}
				item_a_render();
			}
			//-------------------------------------
			m.before_submit = function (data, index) {
				if (m.input.record == undefined) { index.A = $vm.user_name; } //only for add
				data.items = m.item_a_get_data();
				return true;
			}
			//-------------------------------------
			m.after_insert = function (data, res) { after_submit(data, res, res.nr.UID, res.nr.Submit_date); }
			m.after_update = function (data, res) { after_submit(data, res, res.result.UID, res.result.Submit_date); }
			var after_submit = function (data, res, UID, s_date) {
				var new_data = { Data: data, UID: UID, Submit_date: s_date };
				var done = function () {
					var ret = 0, rid = undefined; if (m.input != undefined && m.input.record != undefined) rid = m.input.record._id;
					if (m.input.goback != undefined || rid != undefined) ret = 1;
					$vm.refresh = 1;
					m.change_status++;
					if (ret == 1) window.history.go(-1);            					//from grid
					else $vm.alert('Your data has been successfully submitted');    //standalone
				}
				if (data.Status == 'Submit' || data.Status == 'Draft') {
					$vm.show_module('email-requestor-to-manager', { record: new_data });
				}
				else done();

			}
	
			//----------------------------------
	
			}

		
    </script>
    <style>
        #form_container__ID{
            max-width:800px;
        }
        VmInclude:__CURRENT_PATH__/wappsystem-form.css
		 VmInclude:__COMPONENT__/f/form-item-a.01.css
    </style>
</div>
